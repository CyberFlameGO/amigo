#!/bin/sh

## MANAGED BY ANSIBLE ##
S3_PATH="s3://ophan-dist/ophan-data-lake/$AIRFLOW_STAGE/airflow-assets/"

DAGS_ZIP=dags.zip
PLUGINS_ZIP=plugins.zip


echo "Downloading DAGs from $S3_PATH"
aws s3 cp $S3_PATH$DAGS_ZIP {{ airflow_home }}/

if [ -e {{ airflow_home }}/$DAGS_ZIP ]; then
    unzip -o {{ airflow_home }}/$DAGS_ZIP -d {{ airflow_home }}
    rm -f {{ airflow_home }}/$DAGS_ZIP
else
    echo "WARNING: NO DAGS FOUND IN  {{ airflow_home }}/$DAGS_ZIP"
fi

echo "Downloading plugins folder from $S3_PATH"
aws s3 cp $S3_PATH$PLUGINS_ZIP {{ airflow_home }}/

if [ -e {{ airflow_home }}/$PLUGINS_ZIP ]; then
    unzip -o {{ airflow_home }}/$PLUGINS_ZIP -d {{ airflow_home }}
    rm -f {{ airflow_home }}/$PLUGINS_ZIP
else
    echo "WARNING: NO PLUGINS FOUND IN  {{ airflow_s3_plugins_dir_folder }}$PLUGINS_ZIP"
fi
