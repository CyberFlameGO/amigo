---
- name: Setup target directory
  ansible.builtin.shell: |
    mkdir -p /var/lib/cloud/scripts/per-instance
  when:
    - ansible_os_family == "Debian"

- name: Install instance-tag-discovery
  ansible.builtin.shell: |
    NAME=instance-tag-discovery
    /usr/local/bin/aws s3 cp s3://{{ dist_bucket }}/packages/$NAME/$NAME-linux-{{ deb_arch }} /var/lib/cloud/scripts/per-instance/00-$NAME
    chmod +x /var/lib/cloud/scripts/per-instance/00-$NAME
  when:
    - ansible_os_family == "Debian"

- name: Install devx-logs
  ansible.builtin.shell: |
    NAME=devx-logs
    /usr/local/bin/aws s3 cp s3://{{ dist_bucket }}/packages/$NAME/$NAME-linux-{{ deb_arch }} /var/lib/cloud/scripts/per-instance/01-$NAME
    chmod +x /var/lib/cloud/scripts/per-instance/01-$NAME
  when:
    - ansible_os_family == "Debian"